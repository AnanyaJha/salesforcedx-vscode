I"'<p>ISV カスタマーデバッガは、Apex デバッガで実行可能な操作を補完するものです。ISV は、各自のコードをデバッグできます。登録者も、各自のコードをデバッグできます。ただし、管理コードは保護され、表示できないため、登録者は各自の組織の ISV コードをデバッグすることができません。その場合に ISV カスタマーデバッガを使用すると、ISV が登録者と協力して、登録者の組織に固有の問題をデバッグできます。</p>

<p>ISV は特定の環境で問題を再現できるため、問題が迅速に診断されます。デバッグを実行できるのは Sandbox 組織のみです。</p>

<h2 id="isv-カスタマーデバッガの設定">ISV カスタマーデバッガの設定</h2>

<p>ISV カスタマーデバッガは、Apex 対話型デバッガ (<code>salesforcedx-vscode-apex-debugger</code>) 拡張機能に付属するため、Salesforce Extension Pack とその前提条件以外に何もインストールする必要がありません。デバッグを実行できるのは Sandbox 組織のみです。</p>

<ol>
  <li>ライセンス管理組織 (LMO) 経由で登録者の Sandbox にログインします。このプロセスがよくわからない場合は、『ISVforce ガイド』を参照してください。登録者の組織へのログインアクセス権の取得方法については、<a href="https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/lma_requesting_login_access.htm">「顧客からのログインアクセスの要求」</a>を参照してください。登録者サポートコンソール経由でログインする方法については、<a href="https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/lma_logging_in_to_sub_org.htm">「登録者組織へのログイン」</a>を参照してください。</li>
  <li>登録者の組織で、[設定] から、[クイック検索] ボックスに<strong>「Apex デバッガ」</strong>と入力し、<strong>[Apex デバッガ]</strong> をクリックします。</li>
  <li><strong>[パートナーデバッグセッションを開始]</strong> をクリックします。</li>
  <li>[VS Code 向け Salesforce 拡張機能を使用している場合] セクションで、<code>forceide://</code> URL をコピーして、<strong>[クリップボードにコピー]</strong> をクリックします。</li>
  <li>VS Code で、Ctrl+Shift+P キー (Windows、Linux) または Cmd+Shift+P キー (macOS) を押してコマンドパレットを開き、<strong>[SFDX: Create and Set Up Project for ISV Debugging (ISV デバッグ用プロジェクトを作成および設定)]</strong> を実行します。</li>
  <li>指示に従って、<code>forceide://</code> URL をプロンプトに貼り付け、Enter キーを押します。</li>
  <li>指示に従って、デフォルトのプロジェクト名を受け入れるか、デバッグプロジェクトの名前を入力して、Enter キーを押します。</li>
  <li>プロジェクトを保存する場所を選択して、<strong>[Create Project (プロジェクトを作成)]</strong> をクリックします。</li>
  <li>プロジェクトの生成プロセスが終了するまで待機します。VS Code が、パッケージ化されたメタデータ、登録者のメタデータ、組織の他のパッケージのスケルトンクラスを取得して、ソース形式に変換し、Salesforce DX プロジェクトを作成します。また、このプロジェクトの起動定義 (<code>launch.json</code> ファイル) も作成します。特に大量のメタデータがある組織では、このプロセスに時間がかかるため、実行したままにして後で確認しても構いません。VS Code の下部にある出力パネルで進行状況を監視できます。出力パネルを表示するには、<strong>[View (表示)]</strong> &gt; <strong>[Output (出力)]</strong> を選択し、[Output (出力)] タブの隅にあるドロップダウンメニューから <strong>[Salesforce CLI]</strong> を選択します。<br />
プロジェクトの準備ができたら、VS Code の新しいウィンドウにプロジェクトが開きます。</li>
  <li>新しいウィンドウで、[Explorer (エクスプローラ)] ビューから、ブレークポイントを設定する Apex クラスまたはトリガを開きます。</li>
  <li>ブレークポイントを設定するには、行番号の左側にある余白をクリックします。</li>
  <li>[Debug (デバッグ)] ビューに切り替えます。</li>
  <li>Apex デバッガを起動するには、起動定義ドロップダウンメニューの横にある再生アイコンをクリックします。</li>
</ol>

<h2 id="登録者の組織のデバッグ">登録者の組織のデバッグ</h2>

<p>特筆すべき 1 つの例外を除き、登録者の組織のデバッグも他の組織のデバッグと同じように機能します。例外は、組織の他のユーザがトリガした Apex イベントで中断できない点です。Apex ブレークポイントの到達イベントをトリガできるのは「別名でログイン」ユーザのみです。</p>

<p>Apex デバッガについての詳細は、この README の残りの部分を参照してください。VS Code のデバッグの一般情報については、『Visual Studio Code Docs』の<a href="https://code.visualstudio.com/docs/editor/debugging">「Debugging (デバッグ)」</a>を参照してください。</p>

<h2 id="デバッグセッションの更新">デバッグセッションの更新</h2>

<p>セッションの期限が切れたら、[設定] から、元のセッションの開始時に行った手順をすべて実行して、新しいセッションを開始します。</p>

<h2 id="登録者の知的財産の保護">登録者の知的財産の保護</h2>

<p>登録者の組織から取得したコードは、登録者の知的財産です。デバッグが終了した後もコードを保持しないようにしてください。プロジェクト全体を、設定プロセス時に保存した場所から削除します。登録者のメタデータを自身のバージョン管理システムに絶対に保存しないでください。後々新しいデバッグセッションを開始するときは、VS Code がメタデータを再度ダウンロードします。</p>

<h2 id="isv-カスタマーデバッガに関する考慮事項">ISV カスタマーデバッガに関する考慮事項</h2>

<p>Apex デバッガの一般的な制限と既知の問題については、「Apex 対話型デバッガ」トピックの<a href="interactive-debugger#considerations">「考慮事項」</a>を参照してください。ISV カスタマーデバッガを使用するときは、次の点に留意します。</p>

<ul>
  <li>デバッグを実行できるのは Sandbox 組織のみです。</li>
  <li>一度に 1 人の顧客のみをデバッグできます。ただし、Apex デバッガライセンスを購入している場合は、一度に複数の顧客をデバッグできます。Apex デバッガライセンスがある場合には、Sandbox 組織やスクラッチ組織でもデバッグできます。</li>
  <li>[登録者の概要に戻る] をクリックすると、デバッグセッションが終了します。デバッグ中は登録者の組織にログインしたままにし、デバッグが終了した時点で LMO に戻ります。</li>
</ul>
:ET